{% extends 'gecoviz/base_context.html' %}
{% block gecoviz-script %}
    <script charset="utf-8">
      async function custom_gecoviz(selector) {
        var colors_file = "/static/gecoviz/txt/colors.txt";
        var colors;
        await fetch(colors_file)
            .then(response => response.text())
            .then(hex => colors = eval(hex))
        var urlPath = window.location.pathname.split("/");
        let uploaded_url = String(urlPath[3]).replaceAll(",", "/");
        let inputfile;
        await fetch(uploaded_url)
            .then(response => response.text())
            .then(txt => inputfile = JSON.parse(txt))
        let newick;
        // GET NEWICK IF PROVIDED IN URL...
        await window.launch_gecoviz(selector,
                                 inputfile, 
                                 newick,
                                 41, 
                                 colors);
        d3.select('ul.navbar')
            .style('visibility', 'visible')
            .style('opacity', 1);
    }
    custom_gecoviz("body")
    $('.gecoviz-progress').hide();
  </script>
{% endblock %}
